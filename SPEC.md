# SPEC — Telegram Gift Auction

## Цель
Воспроизвести механику Telegram Gift Auctions — многораундового аукциона цифровых товаров — с фокусом на корректность, конкурентность и продуктовую логику.

## Ключевое допущение
Это **не классический аукцион**.
Высокая ставка не гарантирует мгновенную победу — она влияет на позицию в ранжировании.

## Модель
- **Auction**: параметры, статус, текущий раунд  
- **Round**: тайминг, статус, количество продлений  
- **Entry**: ставка пользователя (одна на аукцион, кумулятивная)

Скрытых состояний нет — всё вычисляется из текущих данных.

## Механика раундов
- Аукцион состоит из последовательных раундов
- В каждом раунде:
  - ACTIVE entries сортируются по `amount DESC, lastBidAt ASC`
  - `awardPerRound` участников получают приз (WON)
  - остальные продолжают участие
- Когда предметы закончились → аукцион COMPLETED

## Ставки
- Один entry на пользователя в рамках аукциона
- Повышение ставки — увеличение amount
- Разрешены ставки меньше чужих:
  - ставка влияет на позицию, а не на мгновенную победу
- Средства резервируются транзакционно

## Anti-sniping
- Если ставка сделана за `thresholdSec` до конца раунда:
  - раунд продлевается на `extendSec`
- Количество продлений ограничено `maxExtensions`
- Защита от:
  - ставок «в последнюю миллисекунду»
  - бесконечных раундов

## Финансовая корректность
- Все операции со ставками — в MongoDB transactions
- Деньги:
  - резервируются при ставке
  - списываются у победителей
  - возвращаются проигравшим
- Нет потерь и дублирования средств

## Конкурентность
- Поддержка одновременных ставок
- Атомарные обновления
- Защита от race conditions

## Проверка под нагрузкой
- Встроенные demo-bots:
  - задаётся количество и интервал
  - параллельные ставки
  - исключены ставки в последние секунды
- Позволяет визуально и технически проверить устойчивость

## Итог
Реализация демонстрирует:
- понимание сложной продуктовой механики,
- осознанные инженерные решения,
- надёжную backend-архитектуру.
